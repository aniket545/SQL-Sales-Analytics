-- Project 2: SQL-Driven Sales & Customer Analytics


-- Query 1: View sample data
SELECT * FROM sales LIMIT 10;


-- Query 2: Total sales and total profit
SELECT
    ROUND(SUM(Sales), 2) AS total_sales,
    ROUND(SUM(Profit), 2) AS total_profit
FROM sales;


-- Query 3: Sales and profit by category
SELECT
    Category,
    ROUND(SUM(Sales), 2) AS total_sales,
    ROUND(SUM(Profit), 2) AS total_profit
FROM sales
GROUP BY Category
ORDER BY total_sales DESC;


-- Query 4: Top 10 products by total sales
SELECT
    "Product Name",
    ROUND(SUM(Sales), 2) AS total_sales
FROM sales
GROUP BY "Product Name"
ORDER BY total_sales DESC
LIMIT 10;


-- Query 5: Sales and profit by region
SELECT
    Region,
    ROUND(SUM(Sales), 2) AS total_sales,
    ROUND(SUM(Profit), 2) AS total_profit
FROM sales
GROUP BY Region
ORDER BY total_profit DESC;


-- Query 6: Orders with negative profit
SELECT
    "Order ID",
    "Product Name",
    Sales,
    Profit
FROM sales
WHERE Profit < 0;


-- Query 7: High-value loss-making orders
SELECT
    Order_ID,
    Product_Name,
    Sales,
    Profit
FROM sales
WHERE Profit < 0 AND Sales > 500;


-- Query 8: Unprofitable categories
SELECT
    Category,
    ROUND(SUM(Profit), 2) AS total_profit
FROM sales
GROUP BY Category
HAVING SUM(Profit) < 0;


-- Query 9: Regions with sales but overall loss
SELECT
    Region,
    ROUND(SUM(Sales), 2) AS total_sales,
    ROUND(SUM(Profit), 2) AS total_profit
FROM sales
WHERE Sales > 100
GROUP BY Region
HAVING SUM(Profit) < 0;


-- Query 10: Total sales in 2017
SELECT
    ROUND(SUM(Sales), 2) AS sales_2017
FROM sales
WHERE substr("Order Date", -4) = '2017';


-- Query 11: Monthly sales trend
SELECT
    substr(Order_Date, -4) || '-' || substr(Order_Date, 1, 2) AS month,
    ROUND(SUM(Sales), 2) AS total_sales
FROM sales
GROUP BY month
ORDER BY month;

Customer & Advanced Analysis

-- Query 12: Top 10 customers by total sales
SELECT
    "Customer Name",
    ROUND(SUM(Sales), 2) AS total_sales
FROM sales
GROUP BY "Customer Name"
ORDER BY total_sales DESC
LIMIT 10;


-- Query 13: Top 10 customers by total profit
SELECT
    "Customer Name",
    ROUND(SUM(Profit), 2) AS total_profit
FROM sales
GROUP BY "Customer Name"
ORDER BY total_profit DESC
LIMIT 10;


-- Query 14: Customers causing highest losses
SELECT
    "Customer Name",
    ROUND(SUM(Profit), 2) AS total_profit
FROM sales
GROUP BY "Customer Name"
HAVING SUM(Profit) < 0
ORDER BY total_profit ASC
LIMIT 10;


-- Query 15: Customer segment performance
SELECT
    Segment,
    ROUND(SUM(Sales), 2) AS total_sales,
    ROUND(SUM(Profit), 2) AS total_profit
FROM sales
GROUP BY Segment
ORDER BY total_profit DESC;


-- Query 16: Repeat customers (placed more than 5 orders)
SELECT
    "Customer Name",
    COUNT(DISTINCT Order_ID) AS total_orders
FROM sales
GROUP BY "Customer Name"
HAVING COUNT(DISTINCT Order_ID) > 5
ORDER BY total_orders DESC;


-- Query 17: Average order value by customer
SELECT
    "Customer Name",
    ROUND(AVG(Sales), 2) AS avg_order_value
FROM sales
GROUP BY "Customer Name"
ORDER BY avg_order_value DESC
LIMIT 10;


-- Query 18: Most profitable sub-categories
SELECT
    "Sub Category",
    ROUND(SUM(Profit), 2) AS total_profit
FROM sales
GROUP BY "Sub Category"
ORDER BY total_profit DESC
LIMIT 10;


-- Query 19: Loss-making sub-categories
SELECT
    "Sub Category",
    ROUND(SUM(Profit), 2) AS total_profit
FROM sales
GROUP BY "Sub Category"
HAVING SUM(Profit) < 0
ORDER BY total_profit ASC;


-- Query 20: Year-wise sales trend
SELECT
    substr("Order Date", -4) AS year,
    ROUND(SUM(Sales), 2) AS total_sales
FROM sales
GROUP BY year
ORDER BY year;

